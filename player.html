<!DOCTYPE html>
<html>
<head>
    <title>Spotify Player</title>
    <script src="https://sdk.scdn.co/spotify-player.js"></script>
</head>
<body>
<h1>Spotify Player</h1>
<div id="status">Loading...</div>
<button onclick="playPause()">Play/Pause</button>
<button onclick="next()">Next</button>
<button onclick="previous()">Previous</button>

<script>
    const urlParams = new URLSearchParams(window.location.search);
    const token = urlParams.get('access_token');  // Get access token from URL

    let device_id = '';
    let player;

    window.onSpotifyWebPlaybackSDKReady = () => {
        player = new Spotify.Player({
            name: 'My Android Web Player',
            getOAuthToken: cb => { cb(token); },
            volume: 0.5
        });

        player.addListener('ready', ({ device_id: id }) => {
            device_id = id;
            document.getElementById('status').innerText = "Player ready: " + device_id;

            // Auto-play a test track
            fetch(`https://api.spotify.com/v1/me/player/play?device_id=${device_id}`, {
                method: "PUT",
                body: JSON.stringify({
                    uris: ["spotify:track:7ouMYWpwJ422jRcDASZB7P"]  // Replace this with your song URI
                }),
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer ' + token
                }
            });
        });

        player.addListener('not_ready', ({ device_id }) => {
            document.getElementById('status').innerText = "Player not ready: " + device_id;
        });

        player.addListener('initialization_error', ({ message }) => {
            console.error('Initialization Error:', message);
        });
        player.addListener('authentication_error', ({ message }) => {
            console.error('Authentication Error:', message);
        });
        player.addListener('account_error', ({ message }) => {
            console.error('Account Error:', message);
        });
        player.addListener('playback_error', ({ message }) => {
            console.error('Playback Error:', message);
        });

        player.connect();
        window.player = player;
    };

    function playPause() {
        if (player) player.togglePlay();
    }

    function next() {
        if (player) player.nextTrack();
    }

    function previous() {
        if (player) player.previousTrack();
    }
</script>
</body>
</html>
